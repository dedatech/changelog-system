# 正式发布内容流程

## 完整发布流程

---

### 第一步：本地编辑

1. **启动后台管理**
   ```bash
   npm run dev:backend
   ```
   访问：http://localhost:3001/admin

2. **创建新版本**
   - 点击右上角 `+ 新建版本`
   - 填写版本号（如：1.2.0）
   - 选择产品类型（IDE/JetBrains/CLI）
   - 填写标题
   - 状态选择 `📝 草稿`

3. **添加更新内容**
   - 添加分类（特性/优化/修复）
   - 添加条目（一级内容）
   - 可选：添加子项（二级内容）
   - 查看左侧实时预览

4. **保存草稿**
   - 点击 `保存` 按钮
   - 数据保存到 `data/changelog.json`

---

### 第二步：检查预览

5. **重新构建**
   ```bash
   npm run build
   ```

6. **启动前台预览**
   ```bash
   npm run dev:frontend
   ```
   访问：http://localhost:3000

7. **检查内容**
   - 切换产品标签查看不同分类
   - 确认格式、层级、内容无误
   - 如果有问题，返回第一步修改

---

### 第三步：发布版本

8. **在后台将版本改为"已发布"**
   - 在管理页面点击 `编辑`
   - 状态改为 `✅ 已发布`
   - 保存

9. **最终构建**
   ```bash
   npm run build
   ```
   此时构建的 HTML 包含了已发布的版本

10. **最终预览确认**
    ```bash
    npm run dev:frontend
    ```
    确认显示正确

---

### 第四步：部署到生产

#### 方案 A：部署到远程服务器

11. **配置服务器信息**

    编辑 `.env.local`：
    ```bash
    DEPLOY_HOST=your-server.com
    DEPLOY_USER=username
    DEPLOY_PASSWORD=password
    # 或使用 SSH 密钥
    ```

12. **一键部署**
    ```bash
    npm run deploy:full
    ```
    这会自动：
    - 构建静态文件
    - 通过 SSH 上传到服务器
    - 执行配置的命令

13. **验证生产环境**
    访问：https://your-domain.com

---

#### 方案 B：本地模拟部署

11. **本地部署**
    ```bash
    npm run deploy:local:full
    ```

12. **预览部署结果**
    ```bash
    npm run preview
    ```
    访问：http://localhost:3000

---

## 流程图示

```
┌─────────────────────────────────────────────────────────┐
│  开发阶段（本地）                                        │
├─────────────────────────────────────────────────────────┤
│  1. 启动后台：npm run dev:backend                      │
│  2. 访问管理：http://localhost:3001/admin              │
│  3. 创建/编辑版本（状态：草稿）                         │
│  4. 保存 → 数据写入 data/changelog.json                │
│                                                         │
│  5. 构建：npm run build                               │
│  6. 预览：npm run dev:frontend                        │
│  7. 检查：http://localhost:3000                       │
│                                                         │
│  8. 修改状态为"已发布"                                 │
│  9. 最终构建：npm run build                           │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│  部署阶段                                               │
├─────────────────────────────────────────────────────────┤
│  方案 A - 远程部署：                                    │
│  10. npm run deploy:full                               │
│      → 构建并上传到服务器                               │
│  11. 访问生产环境：https://your-domain.com              │
│                                                         │
│  方案 B - 本地部署：                                    │
│  10. npm run deploy:local:full                         │
│      → 构建并复制到 dist-local/                         │
│  11. npm run preview                                   │
│      → 预览部署结果                                     │
└─────────────────────────────────────────────────────────┘
```

---

## 关键点说明

### 📝 草稿 vs 已发布

| 状态 | 前台显示 | 说明 |
|------|---------|------|
| 📝 草稿 | ❌ 不显示 | 仅在后台可见，用于编辑中 |
| ✅ 已发布 | ✅ 显示 | 构建后会在前台显示 |

**注意**：构建时只会包含 `status: "published"` 的版本

---

### 🔁 修改已发布的内容

如果发现已发布的内容有错误：

1. 在后台编辑该版本
2. 修改内容
3. 保存
4. **重新构建**：`npm run build`
5. **重新部署**：`npm run deploy:full`

---

### 📦 数据备份

发布前建议备份数据：

```bash
npm run backup
```

备份文件保存在 `data/backups/` 目录

---

### 🚀 快速发布命令

当你已经熟练后，可以使用一键命令：

```bash
# 完整发布流程（编辑 + 构建 + 部署）
npm run dev:backend     # 终端1：编辑内容
# ... 编辑并保存
npm run deploy:full     # 构建 + 部署到服务器
```

---

## 示例：发布一个新版本

```bash
# 1. 启动后台
npm run dev:backend

# 2. 浏览器访问 http://localhost:3001/admin
#    - 点击 "+ 新建版本"
#    - 版本号: 1.2.0
#    - 产品: JetBrains
#    - 标题: 新增数据库支持
#    - 状态: ✅ 已发布
#    - 添加"特性"分类
#    - 添加内容条目
#    - 点击"保存"

# 3. 新终端窗口
npm run build

# 4. 新终端窗口（可选，用于预览）
npm run dev:frontend
# 浏览器访问 http://localhost:3000 确认

# 5. 部署到生产
npm run deploy:full

# 6. 访问生产环境确认
# https://your-domain.com
```

---

## 常见问题

### Q: 可以发布草稿版本吗？
**A**: 不建议。草稿版本不会在前台显示。如果要发布，请先改为"已发布"状态。

### Q: 修改已发布版本后需要重新部署吗？
**A**: 是的。任何内容修改都需要：
1. 重新构建：`npm run build`
2. 重新部署：`npm run deploy`

### Q: 可以批量发布多个版本吗？
**A**: 可以。在后台创建多个版本，全部设为"已发布"，然后一次性构建部署。

### Q: 发布后发现问题怎么办？
**A**:
1. 在后台修改内容
2. 重新构建：`npm run build`
3. 重新部署：`npm run deploy`
